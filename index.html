<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Swishdbgext by comaeio</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Swishdbgext</h1>
          <h2>Incident Response &amp; Digital Forensics Debugging Extension</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/comaeio/SwishDbgExt/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/comaeio/SwishDbgExt/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/comaeio/SwishDbgExt" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="swishdbgext" class="anchor" href="#swishdbgext" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>SwishDbgExt</h1>

<h1></h1>

<p>SwishDbgExt is a Microsoft WinDbg debugging extension that expands the set of available commands by Microsoft WinDbg, but also fixes and improves existing commands.
This extension has been developed by Matt Suiche (<a href="https://github.com/msuiche" class="user-mention">@msuiche</a>) – feel free to reach out on <a href="mailto:support@comae.io">support@comae.io</a> ask for more features, offer to contribute and/or report bugs.</p>

<p>SwishDbgExt aims at making life easier for kernel developers, troubleshooters and security experts with a series of debugging, incident response and memory forensics commands.
Because SwishDbgExt is a WinDbg debugging extension, it means it can be used on local or remote kernel debugging session, live sessions generated by Microsoft LiveKd, but also on Microsoft crash dumps generated to a Blue Screen of Death or hybrid utilities such as Comae DumpIt.</p>

<h2>
<a id="2016-contest" class="anchor" href="#2016-contest" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2016 Contest</h2>

<h3>
<a id="prizes" class="anchor" href="#prizes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prizes</h3>

<ul>
<li>1st place — 1500 USD cash</li>
<li>2nd place — 1000 USD cash</li>
<li>3rd place — 500 USD cash</li>
<li>4th and 5th place — Comae t-shirt.</li>
</ul>

<h3>
<a id="goal" class="anchor" href="#goal" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Goal</h3>

<p>Create a neat and useful command to add to SwishDbgExt WinDbg extension. C++ and ExtRemoteTyped are your best friend.</p>

<h3>
<a id="deadline" class="anchor" href="#deadline" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deadline</h3>

<p>31 December 2016 — and results will be published within 30 days.</p>

<h3>
<a id="submission" class="anchor" href="#submission" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Submission</h3>

<p>Fork the github repository, and provide the link to your branch over email at <a href="mailto:support@comae.io">support@comae.io</a> - More information on <a href="https://blog.comae.io/comae-2016-contest-swishdbgext-features-3c9a63c62209#.tnt1b9usx">https://blog.comae.io/comae-2016-contest-swishdbgext-features-3c9a63c62209#.tnt1b9usx</a></p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p>You can either copy the WinDbg extension in the corresponding (x86 or x64) WinDbg folder or load it manually using the !load command such as below. Please note you can’t have spaces or quotes in the full path to the target dll to be loaded.
<code>!load X:\FullPath\SwishDbgExt.dll</code></p>

<h3>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example:</h3>

<pre><code>kd&gt; !load E:\projects\labs\SwishDbgExt\bin\x64\SwishDbgExt.dll;
       SwishDbgExt v0.7.0 (Nov  2 2016) - Incident Response &amp; Digital Forensics Debugging Extension
       SwishDbgExt Copyright (C) 2016 Comae Technologies FZE - http://www.comae.io
       SwishDbgExt Copyright (C) 2014-2016 Matthieu Suiche (@msuiche)

       This program comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
       This is free software, and you are welcome to redistribute it
       under certain conditions; type `show c' for details.
</code></pre>

<p>If you wish to update your WinDbg template with a more DML-friendly template, you can directly import windbg_template.reg file joined to the package.</p>

<h2>
<a id="todo" class="anchor" href="#todo" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>TODO</h2>

<ul>
<li>[ ] Define structures</li>
<li>[ ] Define Commands</li>
<li>[ ] Announce feature contest.</li>
</ul>

<h2>
<a id="commands" class="anchor" href="#commands" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Commands</h2>

<h3>
<a id="swishdbgexthelp" class="anchor" href="#swishdbgexthelp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!SwishDbgExt.help</h3>

<p>Displays information on available extension commands.</p>

<p>This command will give you the list of all commands if you specify no argument, will give you the list of parameters for an existing command if specified as an argument.</p>

<h3>
<a id="ms_callbacks" class="anchor" href="#ms_callbacks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_callbacks</h3>

<p>Display callback functions</p>

<h3>
<a id="ms_checkcodecave" class="anchor" href="#ms_checkcodecave" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_checkcodecave</h3>

<p>Look for used code cave</p>

<h3>
<a id="ms_consoles" class="anchor" href="#ms_consoles" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_consoles</h3>

<p>Display console command's history </p>

<h3>
<a id="ms_credentials" class="anchor" href="#ms_credentials" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_credentials</h3>

<p>Display user's credentials (based on gentilwiki's mimikatz) </p>

<h3>
<a id="ms_drivers" class="anchor" href="#ms_drivers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_drivers</h3>

<p>Display list of drivers.
!ms_drivers will go ahead and display a list of drivers that are currently loaded.
In this example, here’s a few of the drivers loaded at the time of the crash in this kernel-dump:
With this command, we can also view in-depth IRP information regarding a driver:
In the above image we can see the driver-specific I/O stack location within e1cexpress.sys’ IRP. Here we can see function codes such as IRP_MJ_CREATE which opens the target device object, indicating that it is present and available for I/O operations.</p>

<h3>
<a id="ms_dump" class="anchor" href="#ms_dump" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_dump</h3>

<p>Dump memory space on disk</p>

<h3>
<a id="ms_exqueue" class="anchor" href="#ms_exqueue" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_exqueue</h3>

<p>Display Ex queued workers.</p>

<p><code>!exqueue</code> doesn’t work properly on Windows 8, so a working version needed to be implemented. Just like the original command this one dispaly the working threads queue.</p>

<h3>
<a id="ms_fixit" class="anchor" href="#ms_fixit" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_fixit</h3>

<p>Reset segmentation in WinDbg (Fix "16.kd&gt;")</p>

<h3>
<a id="ms_gdt" class="anchor" href="#ms_gdt" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_gdt</h3>

<p>Display GDT.</p>

<p>!ms_gdt displays the Global Descriptor Table. Note on x64 that every selector is flat (0x0000000000000000 to 0xFFFFFFFFFFFFFFFF). This command can be extra helpful to check for any suspected hooking of the GDT, as attempting to do so on x64 will call a bug check. This is because x64 forbids hooking of the GDT.</p>

<h3>
<a id="ms_hivelist" class="anchor" href="#ms_hivelist" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_hivelist</h3>

<p>Display list of registry hives.</p>

<p><code>ms_hivelist</code> displays a list of registry hives.
We can look directly into a hive (\Registry\Machine\Software for example) to see its subkeys, values, etc:</p>

<h3>
<a id="ms_idt" class="anchor" href="#ms_idt" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_idt</h3>

<p>Display IDT.</p>

<p><code>!ms_idt</code> displays the Interrupt descriptor table. Very much like the GDT, if the IDT is hooked on an x64 system, it will call a bug check. This is due to the fact that Microsoft implemented (programmatically) a prevention of hooking the IDT with a kernel-mode driver that would normally intercept calls to the IDT and then add in its own processing. This is why in the above image, there is ‘No’ as far as the eye can see.</p>

<h3>
<a id="ms_malscore" class="anchor" href="#ms_malscore" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_malscore</h3>

<p>Analyze a memory space and returns a Malware Score Index (MSI) - (based on Frank Boldewin's work)</p>

<h3>
<a id="ms_mbr" class="anchor" href="#ms_mbr" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_mbr</h3>

<p>Scan Master Boot Record (MBR)</p>

<h3>
<a id="ms_netstat" class="anchor" href="#ms_netstat" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_netstat</h3>

<p>Display network information (sockets, connections, ...)</p>

<h3>
<a id="ms_object" class="anchor" href="#ms_object" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_object</h3>

<p>Display list of object</p>

<h3>
<a id="ms_process" class="anchor" href="#ms_process" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_process</h3>

<p>Display list of processes.
<code>!ms_process</code> is an improved version of <code>!process</code> and <code>!dml_proc</code>..
One of the nice thing as you can notice below is the usage of DML (Debugger Markup Language) with the commands. All the underline commands are in fact links to commands.
As an example below, you can see the output of /vads /scan, to scan VAD (Virtual Address Descriptors). You can notice that one column gives the “Malware Score Index” which can be useful to detect shellcodes or heap-spray.
In the screenshot below, you can see an abnormally high score in several VADs – due to usage of heap spray. Just by clicking on the score it will run the scanning algorithm.
The scanning algorithm is based on Frank Boldewin’s OfficeMalScanner utility.
And returns you information about where the shellcode is:
<code>/scan</code> option can also be used on exported functions to know if the EAT (Export Address Table) has been patched or if the prolog of the function modified.</p>

<p>Similar tests are available for the SSDT (<code>!ms_ssdt</code>).</p>

<h3>
<a id="ms_readkcb" class="anchor" href="#ms_readkcb" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_readkcb</h3>

<p>Read key control block</p>

<h3>
<a id="ms_readknode" class="anchor" href="#ms_readknode" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_readknode</h3>

<p>Read key node.
<code>!reg</code> WinDbg command has been a frustration for a long time, due to some bugs. This is why SwishDbgExt, has its own registry explorer functions to try to make access to registry data as simple as possible.</p>

<h3>
<a id="ms_readkvalue" class="anchor" href="#ms_readkvalue" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_readkvalue</h3>

<p>Read key value</p>

<h3>
<a id="ms_scanndishook" class="anchor" href="#ms_scanndishook" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_scanndishook</h3>

<p>Scan and display suspicious NDIS hooks</p>

<h3>
<a id="ms_services" class="anchor" href="#ms_services" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_services</h3>

<p>Display list of services</p>

<h3>
<a id="ms_ssdt" class="anchor" href="#ms_ssdt" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_ssdt</h3>

<p>Display service descriptor table (SDT) functions.
<code>!ms_ssdt</code> displays the System Service Dispatch Table. This command is extremely helpful in the investigation of suspected rootkit hooks through what is known as Direct Kernel Object Manipulation (DKOM). If you see a low level routine here that is hooked (such as nt!NtEnumerateKey), this can aid you in your analysis regarding a possible rootkit infection.</p>

<h3>
<a id="ms_store" class="anchor" href="#ms_store" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_store</h3>

<p>Display information related to the Store Manager (ReadyBoost).</p>

<p>The present command allows to list the current ReadyBoost (requires USB 3.0) cache used by the Operating System, but also to display the logs of the memory pages managed by the store manager.
Parameter: /cache</p>

<h3>
<a id="ms_timers" class="anchor" href="#ms_timers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_timers</h3>

<p>Display list of KTIMER.</p>

<p>!ms_timers displays the KTIMER structure, which is an opaque structure that represents and contains various timer objects. This command can be helpful to figure out what drivers created what timer objects, what drivers called what routines, etc.</p>

<h3>
<a id="ms_vacbs" class="anchor" href="#ms_vacbs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_vacbs</h3>

<p>Display list of cached VACBs</p>

<h3>
<a id="ms_verbose" class="anchor" href="#ms_verbose" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>!ms_verbose</h3>

<p>Turn verbose mode on/off</p>

<h2>
<a id="classes" class="anchor" href="#classes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Classes</h2>

<h3>
<a id="pefile" class="anchor" href="#pefile" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PEFile</h3>

<p><code>MsPEImageFile</code> contains the basic common information used by Windows binaries (PE) and has been derivated into three different classes:</p>

<ul>
<li>MsProcessObject</li>
<li>MsDllObject</li>
<li>MsDriverObject</li>
</ul>
        </section>

        <footer>
          Swishdbgext is maintained by <a href="https://github.com/comaeio">comaeio</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
